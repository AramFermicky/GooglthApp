<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ù–æ–≤—ã–π —á–∞—Ç</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="slide-in">
  <div class="mobile-frame">
    <div class="new-chat-container">
      <header class="new-chat-header">
        <button class="back-btn" onclick="window.history.back()">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
        </button>
        <h1>–ù–æ–≤—ã–π —á–∞—Ç</h1>
      </header>
      
      <div class="search-box">
        <input type="text" id="chat-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email...">
      </div>
      
      <div class="chats-list" id="chats-list">
        <div class="empty-state">
          <div class="empty-icon">üîç</div>
          <h3>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π</h3>
          <p>–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ email –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π GooglthApp</p>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('chat-search');
      const chatsList = document.getElementById('chats-list');
      
      // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
      searchInput.addEventListener('input', () => {
        const query = searchInput.value;
        
        if (query.length < 2) {
          chatsList.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üîç</div>
              <h3>–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π</h3>
              <p>–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ email –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π GooglthApp</p>
            </div>
          `;
          return;
        }
        
        const results = AuthSystem.searchUsers(query);
        
        if (results.length > 0) {
          chatsList.innerHTML = results.map(user => `
            <div class="contact-item" onclick="startChat('${user.id}', '${user.name}')">
              <div class="contact-avatar">${user.name.charAt(0)}</div>
              <div class="contact-info">
                <div class="contact-name">${user.name}</div>
                <div class="contact-email">${user.email}</div>
              </div>
              <div class="chat-status ${user.online ? 'online' : ''}"></div>
            </div>
          `).join('');
        } else {
          chatsList.innerHTML = `
            <div class="no-results">
              –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
            </div>
          `;
        }
      });
      
      // –ù–∞—á–∞–ª–æ —á–∞—Ç–∞
      window.startChat = (userId, userName) => {
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–µ—Å—Å–∏–∏
        sessionStorage.setItem('p2p_target_user', JSON.stringify({ id: userId, name: userName }));
        
        // –ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å P2P-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        if (window.p2pManager) {
          window.p2pManager.createOffer(userId).then(result => {
            if (!result.success) {
              console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:', result.error);
            }
          });
        }
        
        navigateTo('p2p-chat.html');
      };
    });
  </script>
  <script src="script.js"></script>
</body>
</html>